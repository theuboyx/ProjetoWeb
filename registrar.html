<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registrar - CodeMovie</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  body{
    margin:0;
    min-height:100vh;
    font-family: Arial, Helvetica, sans-serif;
    background-image: url('https://images.unsplash.com/photo-1595769816263-9b910be24d5f?q=80&w=1179&auto=format&fit=crop');
    background-size: cover;
    background-position: center;
    display:flex; align-items:center; justify-content:center;
  }
  body::before{
    content:"";
    position:fixed; inset:0;
    background:rgba(0,0,0,0.55);
    backdrop-filter: blur(3px);
  }

  .box{
    position:relative; z-index:2;
    width:380px;
    padding:26px;
    border-radius:12px;
    background: rgba(28,28,28,0.92);
    box-shadow:0 0 20px rgba(46,115,226,0.45);
    border:1px solid rgba(255,255,255,0.05);
  }

  h2{
    text-align:center;
    color:#8ab4ff;
    margin-bottom:20px;
    font-weight:700;
  }

  .input-box{
    position:relative;
    margin-bottom:18px;
  }

  .input-box input{
    width:100%;
    height:48px;
    border-radius:8px;
    padding-left:42px;
    padding-right:42px;
    border:1px solid #3f6cff;
    background:#1f1f1f;
    color:#fff;
  }

  .input-box i{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    left:14px;
    color:#8ab4ff;
    font-size:16px;
    pointer-events:none;
  }

  .toggle-eye{
    pointer-events:auto !important;
    position:absolute;
    right:14px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
    color:#8ab4ff;
  }

  /* Barra de força FORA do input-box */
  .strength{
    height:8px;
    width:100%;
    background:#333;
    border-radius:6px;
    overflow:hidden;
    margin-top:-10px;
    margin-bottom:4px;
  }

  .strength div{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#ff6b6b,#ffd24d,#6effa1);
    transition:width .3s;
  }

  .btn-primary{
    background:#0b65c2;
    border:none;
    padding:10px;
    border-radius:8px;
    font-weight:700;
  }

  .link-row{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:12px;
  }
  .link-row a{
    color:#9bb8ff;
    text-decoration:none;
  }

  #msg{
    text-align:center;
    height:18px;
    margin-top:6px;
    font-size:14px;
  }

  .shake{
    animation:shake .35s;
  }
  @keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-6px)}
    50%{transform:translateX(6px)}
    75%{transform:translateX(-6px)}
    100%{transform:translateX(0)}
  }
</style>
</head>
<body>

<div class="box">

  <h2>Criar conta</h2>

  <!-- Nome -->
  <div class="input-box">
    <i class="fa-solid fa-id-card"></i>
    <input id="fullName" placeholder="Nome completo">
  </div>

  <!-- Usuário -->
  <div class="input-box">
    <i class="fa-solid fa-user"></i>
    <input id="username" placeholder="Usuário (login)">
  </div>

  <!-- Email -->
  <div class="input-box">
    <i class="fa-solid fa-envelope"></i>
    <input id="email" placeholder="E-mail">
  </div>

  <!-- SENHA (input separado da barra de força) -->
  <div class="input-box">
    <i class="fa-solid fa-lock"></i>
    <input id="password" type="password" placeholder="Senha">
    <i class="fa-solid fa-eye toggle-eye" onclick="togglePassword()" id="togglePass"></i>
  </div>

  <div class="strength"><div id="strengthBar"></div></div>
  <div id="strengthText" style="font-size:12px;color:#9aaed3;margin-bottom:14px;">Força da senha</div>

  <!-- Confirmar -->
  <div class="input-box">
    <i class="fa-solid fa-lock"></i>
    <input id="confirmPassword" type="password" placeholder="Confirmar senha">
  </div>

  <button class="btn btn-primary w-100" onclick="registerUser()">Criar Conta</button>

  <div id="msg"></div>

  <div class="link-row">
    <a href="index.html">Voltar para login</a>
    <a href="resetsenha.html">Esqueci minha senha</a>
  </div>

  <div style="font-size:12px;color:#9aaed3;text-align:center;margin-top:10px">
    Ao criar, seus dados ficarão salvos localmente no navegador.
  </div>

</div>

<script>
function getUsers(){ return JSON.parse(localStorage.getItem('cm_users') || '[]'); }
function saveUsers(arr){ localStorage.setItem('cm_users', JSON.stringify(arr)); }

function togglePassword(){
  const p = document.getElementById('password');
  p.type = p.type === 'password' ? 'text' : 'password';
  document.getElementById('togglePass').classList.toggle('fa-eye-slash');
}

document.getElementById('password').addEventListener('input', updateStrength);

function updateStrength(){
  const s = document.getElementById('password').value;
  const bar = document.getElementById('strengthBar');
  const text = document.getElementById('strengthText');

  let score = 0;
  if (s.length >= 8) score++;
  if (/[A-Z]/.test(s)) score++;
  if (/[0-9]/.test(s)) score++;
  if (/[^A-Za-z0-9]/.test(s)) score++;

  const pct = (score / 4) * 100;
  bar.style.width = pct + '%';

  if(score <= 1){ text.innerText = 'Senha fraca'; text.style.color = '#ff6b6b'; }
  else if(score === 2){ text.innerText = 'Senha média'; text.style.color = '#ffd24d'; }
  else { text.innerText = 'Senha forte'; text.style.color = '#6effa1'; }
}

function shake(el){ el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'),350); }

function registerUser(){
  const name = fullName.value.trim();
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirm = document.getElementById('confirmPassword').value;
  const msg = document.getElementById('msg');

  if(!name || !username || !email || !password || !confirm){
    msg.style.color='salmon'; msg.innerText='Preencha todos os campos'; shake(msg); return;
  }
  if(password !== confirm){
    msg.style.color='salmon'; msg.innerText='Senhas não conferem'; shake(msg); return;
  }
  if(password.length < 6){
    msg.style.color='salmon'; msg.innerText='Senha muito curta (mín 6)'; shake(msg); return;
  }

  const users = getUsers();
  if(users.some(u => u.username.toLowerCase() === username.toLowerCase())){
    msg.style.color='salmon'; msg.innerText='Usuário já cadastrado'; shake(msg); return;
  }
  if(users.some(u => u.email.toLowerCase() === email.toLowerCase())){
    msg.style.color='salmon'; msg.innerText='E-mail já cadastrado'; shake(msg); return;
  }

  users.push({ username, name, email, password });
  saveUsers(users);

  localStorage.setItem('cm_session', username);

  msg.style.color='lightgreen';
  msg.innerText='Cadastro realizado! Entrando...';

  setTimeout(()=>location.href='dashboard.html',900);
}
</script>

</body>
</html>
